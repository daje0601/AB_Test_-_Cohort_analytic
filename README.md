# AB_Testì™€ Cohort_analyticì„ í™œìš©í•œ ê³ ê°ë¶„ì„ 


## ğŸ”¶ì‹œë‚˜ë¦¬ì˜¤

> ê°•ë‹¤ì†” ì§€ì›ìëŠ” ë°ì´í„° ë¶„ì„ê°€ë¡œ ì…ì‚¬ë¥¼ í•˜ê²Œ ë˜ì—ˆìŠµë‹ˆë‹¤. ë§ˆì¼€íŒ…íŒ€ì—ì„œ ì›¹í˜ì´ì§€ ë³€ê²½ ê±´ ê´€ë ¨ A/B í…ŒìŠ¤íŠ¸ë¥¼ ìš”ì²­í•˜ì…¨ìŠµë‹ˆë‹¤. íŒ€ì¥ë‹˜ê»˜ ë³´ê³ ë“œë¦° í›„ í•´ë‹¹ ë¶„ì„ì„ ë‹´ë‹¹í•˜ê²Œ ë˜ì—ˆìŠµë‹ˆë‹¤. google analytics(GA)ë¥¼ í™œìš©í•˜ì—¬ funnel ë¶„ì„ ê²°ê³¼, ì¥ë°”êµ¬ë‹ˆì—ì„œ ê²°ì œë¡œ ì´ì–´ì§€ëŠ” êµ¬ê°„ì—ì„œ ê°€ì¥ í° ì´íƒˆì´ ìˆëŠ” ê²ƒìœ¼ë¡œ í™•ì¸ë˜ì—ˆìŠµë‹ˆë‹¤.
í˜„ì¬ ì¥ë°”êµ¬ë‹ˆ í˜ì´ì§€ì—ì„œ ê²°ì œ í˜ì´ì§€ë¡œ ì „í™˜ë˜ëŠ” ë¹„ìœ¨ì€ 23%ì´ë©°, ë§ˆì¼€íŒ…íŒ€ê³¼ í˜‘ì˜í•˜ì—¬ 25%ë¡œ ì „í™˜ìœ¨ì„ ì˜¬ë¦¬ë©´ í•´ë‹¹ ë¶„ì„ì€ ì„±ê³µí•œ ê²ƒìœ¼ë¡œ ê°„ì£¼í•˜ê¸°ë¡œ í˜‘ì˜í•˜ì˜€ìŠµë‹ˆë‹¤.

## ğŸ”¶ A/B test ìƒì„¸ë‚´ì—­

- ëª©í‘œ ì§€ìˆ˜ : ì „í™˜ìœ¨ 2 % ìƒìŠ¹ ( ì¥ë°”êµ¬ë‹ˆ -> ê²°ì œ )
- ê¸°ê°„ : 21ì¼ ( ì£¼ì¤‘, ì£¼ë§ê°„ì˜ ê³ ê°ì˜ í–‰ë™ íŒ¨í„´ì„ ëª¨ë‘ í¬í•¨í•˜ì—¬ì•¼ í•˜ê¸°ì— 21ì¼ë¡œ ì„¤ì • )
- ê°€ì„¤ : ì¥ë°”êµ¬ë‹ˆ í˜ì´ì§€ì—ì„œ ê²°ì œ í˜ì´ì¡¸ ë„˜ì–´ê°€ëŠ” ë²„íŠ¼ì˜ ë””ìì¸ì„ ë³€ê²½í•˜ë©´ êµ¬ë§¤ ì „í™˜ìœ¨ì´ 2% ì´ìƒ ì¦ê°€í•  ê²ƒì´ë‹¤.

      ( ì‹ ë¢°ë„ : 95% / Î±:0.05 / One- and two-tailed tests ì‚¬ìš© : ì „í™˜ìœ¨ì´ ë‚®ì•„ì§ˆ ìˆ˜ë„ ìˆìŒ )

- A/Bí…ŒìŠ¤íŠ¸ ë‚´ìš© : ê¸°ì¡´ì˜ ì‚¬ì´íŠ¸ì™€ ë²„íŠ¼ì„ ë³€ê²½í•œ ì‚¬ì´íŠ¸ ë‘˜ì„ 50%ì˜ í™•ë¥ ë¡œ ëœë¤í•˜ê²Œ ë…¸ì¶œì‹œí‚´
- ì§€í‘œ í™•ì¸ : 21ì¼ í›„ ì „í™˜ìœ¨ í‰ê· ê°’ ë¹„êµ

(ë‹¨, myrealtripì˜ ê¸°ì¡´ ë°ì´í„°ê°€ ëˆ„ì ë˜ì–´ ìˆê³  ê³ ê°ë“¤ì˜ í–‰ë™íŒ¨í„´ì„ ì‚¬ì „ì— íŒŒì•…í•˜ê³  ìˆë‹¤ê³  ê°€ì •í•˜ê³  í•´ë‹¹ ë¶„ì„ì—ì„œëŠ” A/A testëŠ” ì§„í–‰í•˜ì§€ ì•Šë„ë¡ í•˜ê² ìŠµë‹ˆë‹¤.)

![image](https://user-images.githubusercontent.com/73736988/128304732-fb082f36-0e91-4300-a9f5-9304c14c5532.png)


## ğŸ”¶ í‘œë³¸ ì„¤ì • & ì „í™˜ìœ¨

### 1. **í‘œë³¸ ì„¤ì •**

- ë³¸ê²©ì ì¸ ë¶„ì„ì— ì•ì„œì„œ í‘œë³¸ì„ ì„¤ì •í•˜ëŠ” ì‘ì—…ì´ í•„ìš”í•©ë‹ˆë‹¤.
- A/Bí…ŒìŠ¤íŠ¸ë¥¼ ì² ì €í•˜ê²Œ í•˜ë”ë¼ë„ 10ëª… ë¯¸ë§Œì˜ ê³ ê°ì´ ìœ ì…ëœë‹¤ë©´ ë¶„ì„ì„ ì‹ ë¢°í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.
- ë˜í•œ, í‘œë³¸ì˜ í¬ê¸°ëŠ” p-valueì˜ ë¯¼ê°ë„ì— ì˜í–¥ì„ ì£¼ê¸° ë•Œë¬¸ì— ì ì •í•œ í‘œë³¸ì˜ í¬ê¸°ëŠ” ì¤‘ìš”í•˜ë‹¤ê³  ìƒê°í•˜ì˜€ìŠµë‹ˆë‹¤. ( í‘œë³¸ ì»¤ì§ˆìˆ˜ë¡ p-valueëŠ” ì‘ì•„ì§€ê¸° ë•Œë¬¸ì…ë‹ˆë‹¤. )
- ì´ì—, ìµœì†Œ í‘œë³¸ ì¸ì›ì„ ì„¤ì •í•˜ì˜€ìŠµë‹ˆë‹¤.
- í‘œë³¸ì˜ í¬ê¸°ëŠ” ê²€ì •ë ¥ ë¶„ì„(power of test)ë¡œ êµ¬í•  ìˆ˜ ìˆìœ¼ë©°, ê´€ë¡€ì ìœ¼ë¡œ powerë¥¼ 0.8ë¡œ ì‚¬ìš©í•˜ê¸°ì— í•´ë‹¹ í”„ë¡œì íŠ¸ì—ì„œë„ 0.8ë¡œ í™œìš©í•˜ë„ë¡ í•˜ê² ìŠµë‹ˆë‹¤.
- ë˜í•œ, í•œ ê³ ê°ì€ í•œ ê·¸ë£¹ì—ë§Œ í¬í•¨ë˜ì–´ì•¼ í•˜ë¯€ë¡œ ì¤‘ë³µëœ ê³ ê°ì€ ì œê±°í•´ ì£¼ì—ˆìŠµë‹ˆë‹¤.

```jsx
import scipy.stats as stats 
import statsmodels.stats.api as sms 
from math import ceil 

# ì˜ˆìƒ ë¹„ìœ¨ì„ ê¸°ë°˜ìœ¼ë¡œ effectsize(íš¨ê³¼) ê³„ì‚° 
effect_size = sms.proportion_effectsize(0.23, 0.25) 

# ìƒ˜í”Œ í¬ê¸° êµ¬í•˜ê¸° 
sample_size = sms.NormalIndPower().solve_power(effect_size, power=0.8, 
                                               alpha=0.05, ratio=1)

# ì¦‰, A,B ê·¸ë£¹ì— ìµœì†Œ 7155ëª…ì˜ ê³ ê° ìˆ˜ í•„ìš” 
print("sample_size : ", round(sample_size), "ëª…") 
print("effect_size : ", effect_size.round(5))
```

### 2. **ì „í™˜ìœ¨**

```jsx
# ì „í™˜ìœ¨ì„ ê³„ì‚°í•´ë³´ê² ìŠµë‹ˆë‹¤. 
conversion_rates = ab_test.groupby('group')['converted']

std_p = lambda x: np.std(x, ddof=0)              # Std. deviation of the proportion êµ¬í•˜ê¸° 
se_p = lambda x: stats.sem(x, ddof=0)            # Std. error of the proportion (std / sqrt(n)) êµ¬í•˜ê¸° 

conversion_rates = conversion_rates.agg([np.mean, std_p, se_p])
conversion_rates.columns = ['conversion_rate', 'std_deviation', 'std_error']

conversion_rates.style.format('{:.3f}')

```


## ğŸ”¶ A/B í…ŒìŠ¤íŠ¸


### 1. **ì§„í–‰ ì ˆì°¨**

- A, B group ìƒì„±
- **Shapiro-wilk test**ë¥¼ í™œìš©í•œ ì •ê·œì„± í™•ì¸
- Shapiro-wilk testë¥¼ í†µê³¼í•˜ì§€ ëª»í•œ ê²½ìš°, **Mann Whitney U Test** ë‘ ê·¸ë£¹ ì°¨ì´ í™•ì¸
- Shapiro-wilk testë¥¼ í†µê³¼í•œ ê²½ìš°, **Levene test**ë¡œ ë‘ ê·¸ë£¹ê°„ì˜ ë¶„ì‚° í™•ì¸
- Levene testë¥¼ í†µê³¼í•˜ì§€ ëª»í•œ ê²½ìš°, **apply Welch test**ë¡œ í‰ê·  í™•ì¸
- Levene testë¥¼ í†µê³¼í•œ ê²½ìš°, **t-test**ë¡œ í‰ê·  í™•ì¸ / [A/B í…ŒìŠ¤íŠ¸ ë¸”ë¡œê·¸ ì •ë¦¬ ë§í¬](https://daje0601.tistory.com/267)

### 2. ì½”ë“œ

```jsx
# A/B Testing í•¨ìˆ˜
def AB_Test(dataframe, group, target):
    
    # ë¼ì´ë¸ŒëŸ¬ë¦¬ 
    from scipy.stats import shapiro
    import scipy.stats as stats
    
    # ë°ì´í„° ìƒ˜í”Œë§ 
    groupA = dataframe[dataframe[group] == 'control'].sample(n=7200, random_state=42)[target]
    groupB = dataframe[dataframe[group] == 'treatment'].sample(n=7200, random_state=42)[target]

    # Normality(ì •ê·œì„±) í™•ì¸í•˜ê¸° 
    ntA = shapiro(groupA)[1] < 0.05
    ntB = shapiro(groupB)[1] < 0.05
    # H0(ê·€ë¬´ê°€ì„¤): ì •ê·œë¶„í¬ì´ë‹¤. - ê²°ê³¼ê°’ : False
    # H1(ëŒ€ë¦½ê°€ì„¤): ì •ê·œë¶„í¬ê°€ ì•„ë‹ˆë‹¤. - ê²°ê³¼ê°’ : True
    
    # "H0(ê·€ë¬´ê°€ì„¤)ì´ ì„±ë¦½í•  ê²½ìš°, ë°ì´í„°ëŠ” ì •ê·œë¶„í¬ì´ë¯€ë¡œ ëª¨ìˆ˜ê²€ì •ì„ ì§„í–‰í•©ë‹ˆë‹¤. "
    if (ntA == False) & (ntB == False): 
        # ë‘ ê·¸ë£¹ê°„ì— ë¶„ì‚°ì´ ê°™ì€ì§€ë¥¼ í™•ì¸í•©ë‹ˆë‹¤. 
        leveneTest = stats.levene(groupA, groupB)[1] < 0.05
        # H0(ê·€ë¬´ê°€ì„¤): ë‘ ê·¸ë£¹ê°„ì˜ ë¶„ì‚°ì´ ê°™ë‹¤. - ê²°ê³¼ê°’ : False
        # H1(ëŒ€ë¦½ê°€ì„¤): ë‘ ê·¸ë£¹ê°„ì˜ ë¶„ì‚°ì´ ë‹¤ë¥´ë‹¤. - ê²°ê³¼ê°’ : True
        
        if leveneTest == False:
            # ë¶„ì‚°ì´ ê°™ì€ ê²½ìš°, t-testë¥¼ ì§„í–‰í•©ë‹ˆë‹¤. 
            ttest = stats.ttest_ind(groupA, groupB, equal_var=True)[1]
            # H0(ê·€ë¬´ê°€ì„¤): ë‘ ê·¸ë£¹ê°„ì˜ í‰ê· ì´ ê°™ë‹¤. - ê²°ê³¼ê°’ : False
            # H1(ëŒ€ë¦½ê°€ì„¤): ë‘ ê·¸ë£¹ê°„ì˜ í‰ê· ì´ ë‹¤ë¥´ë‹¤. - ê²°ê³¼ê°’ : True
        else:
            # ë¶„ì‚°ì´ ë‹¤ë¥¸ ê²½ìš°, leveneTestë¥¼ ì§„í–‰í•©ë‹ˆë‹¤. 
            ttest = stats.ttest_ind(groupA, groupB, equal_var=False)[1]
            # H0(ê·€ë¬´ê°€ì„¤): ë‘ ê·¸ë£¹ê°„ì˜ í‰ê· ì´ ê°™ë‹¤. - ê²°ê³¼ê°’ : False
            # H1(ëŒ€ë¦½ê°€ì„¤): ë‘ ê·¸ë£¹ê°„ì˜ í‰ê· ì´ ë‹¤ë¥´ë‹¤. - ê²°ê³¼ê°’ : True
    else:
        # Non-Parametric Test
        ttest = stats.mannwhitneyu(groupA, groupB)[1] 
        # H0(ê·€ë¬´ê°€ì„¤): ë‘ ê·¸ë£¹ì´ ê°™ë‹¤. - ê²°ê³¼ê°’ : False
        # H1(ëŒ€ë¦½ê°€ì„¤): ë‘ ê·¸ë£¹ì´ ë‹¤ë¥´ë‹¤. - ê²°ê³¼ê°’ : True
        
    # ê²°ê³¼ ë„ì¶œ 
    temp = pd.DataFrame({
        "AB Hypothesis":[ttest < 0.05], 
        "p-value":[ttest]
    })
    temp["Test Type"] = np.where((ntA == False) & (ntB == False), "Parametric", "Non-Parametric")
    temp["AB Hypothesis"] = np.where(temp["AB Hypothesis"] == False, "Fail to Reject H0", "Reject H0")
    temp["Comment"] = np.where(temp["AB Hypothesis"] == "Fail to Reject H0", "A/B groups are similar!", "A/B groups are not similar!")
    
    # ì»¬ëŸ¼ ìƒì„± 
    if (ntA == False) & (ntB == False):
        temp["Homogeneity"] = np.where(leveneTest == False, "Yes", "No")
        temp = temp[["Test Type", "Homogeneity","AB Hypothesis", "p-value", "Comment"]]
    else:
        temp = temp[["Test Type","AB Hypothesis", "p-value", "Comment"]]
    
    # Print Hypothesis
    print("# A/B Testing Hypothesis")
    print("H0: A == B")
    print("H1: A != B", "\n")
    
    return temp
    

AB_Test(dataframe=ab_test, group = "group", target = "converted")
```

## ğŸ”¶ A/B í…ŒìŠ¤íŠ¸


- A/B testì—ì„œ sharpio-wilk test ê²°ê³¼ê°€ ì •ê·œë¶„í¬ë¥¼ ë”°ë¥´ì§€ ì•Šì•„ Non-Parametric ê²€ì •ì„ í†µí•˜ì—¬ A/B testê°€ ì§„í–‰ë˜ì—ˆìŠµë‹ˆë‹¤.
- p-value(0.3585)ê°€ Î±(0.05)ë³´ë‹¤ í¬ë¯€ë¡œ ê·€ë¬´ê°€ì„¤ì„ ê¸°ê°í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.
- ì¦‰, Aê·¸ë£¹ê³¼ Bê·¸ë£¹ì´ ìœ ì‚¬í•¨ìœ¼ë¡œ í†µê³„ì  í™•ì¸í•˜ì˜€ê³ , ì €í¬ê°€ ë³€ê²½í•œ ì›¹ ë””ìì¸ì€ ìœ íš¨í•˜ì§€ ì•Šì€ ê²ƒìœ¼ë¡œ íŒëª…ë˜ì—ˆìŠµë‹ˆë‹¤.
- ì´ ë‚´ìš©ì„ ë””ìì¸íŒ€ì— ë¹ ë¥´ê²Œ ê³µìœ í•˜ì—¬ í›„ì† ì‹¤í—˜ì´ ì§„í–‰ë  ìˆ˜ ìˆë„ë¡ ì¡°ì¹˜ í•˜ì˜€ìŠµë‹ˆë‹¤.

![image](https://user-images.githubusercontent.com/73736988/128304833-f3adcb3a-f8d6-4a4b-8bc4-68d880dd0307.png)

---
---

# 2. Cohort Analytic

(A/B í…ŒìŠ¤íŠ¸ì™€ ë³„ë„ì˜ ë°ì´í„°ë¥¼ í™œìš©í•˜ì—¬ ë¶„ì„í•˜ì˜€ìŠµë‹ˆë‹¤.)

![image](https://user-images.githubusercontent.com/73736988/128311075-c80fa008-3534-495c-b6e7-acf7fcf3be7b.png)

### **Conclustion**

- í•´ë‹¹ ì„œë¹„ìŠ¤ë¥¼ ì´ìš©í•˜ëŠ” ê³ ê°ë¶„ë“¤ì€ 6ì£¼ì°¨ê°€ ë˜ë©´ ì¬êµ¬ë§¤í™œë™ì´ ì¤„ì–´ë“œëŠ” ê²ƒì„ ê´€ì¸¡í•  ìˆ˜ ìˆë‹¤. ì´ë¥¼ ê¸°ì¤€ìœ¼ë¡œ ìš°ë¦¬ ê³ ê°ë“¤ì€ 6ì£¼ì°¨ë¶€í„° ì¬êµ¬ë§¤ë¥¼ í•˜ì§€ ì•ŠëŠ”ë‹¤ëŠ” ê°€ì„¤ì„ ìƒˆì›Œ ì‹¤í—˜ì„ í•´ë³¼ ìˆ˜ ìˆë‹¤.
- ë˜í•œ, 2009-06, 2009-07, 2009-09, 2010-01 0ì£¼ì°¨ì— í° í­ì˜ ìœ ì…ì´ ìˆëŠ” ê²ƒìœ¼ë¡œ ê´€ì¸¡ì´ ë˜ì—ˆë‹¤. ì´ë•Œ í–‰ì‚¬ë¥¼ ì§„í–‰í•˜ì˜€ëŠ”ì§€ í™•ì¸í•´ë³¼ í•„ìš”ê°€ ìˆê³ , 2ì£¼ì°¨ê¹Œì§€ ì¬êµ¬ë§¤ ì „í™˜ìœ¨ì„ ì•½ 50%ë¡œ ì¶”ì¸¡í•´ë³¼ ìˆ˜ ìˆë‹¤. ì‚¬ë‚´ì— ë¹„êµí•œ í”„ë¡œëª¨ì…˜ íš¨ìœ¨ ê´€ë ¨ ìë£Œë„ í•¨ê»˜ ê²€í† í•˜ì—¬ ë°œê²¬í•œ ì¸ì‚¬ì´íŠ¸ë“¤ì´ ë§ëŠ”ì§€ í™•ì¸í•´ë³¼ ìˆ˜ ìˆë‹¤.
